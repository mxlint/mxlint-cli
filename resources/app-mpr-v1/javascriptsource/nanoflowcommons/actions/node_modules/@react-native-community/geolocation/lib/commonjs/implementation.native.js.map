{"version":3,"sources":["implementation.native.js"],"names":["subscriptions","updatesEnabled","Geolocation","setRNConfiguration","config","RNCGeolocation","setConfiguration","requestAuthorization","getCurrentPosition","geo_success","geo_error","geo_options","logError","watchPosition","success","error","options","startObserving","watchID","length","push","GeolocationEventEmitter","addListener","clearWatch","sub","remove","sub1","undefined","noWatchers","ii","stopObserving","module","exports"],"mappings":"kKAUA,kDAEA,4DACA,8BAEA,GAAIA,CAAAA,aAAa,CAAG,EAApB,CACA,GAAIC,CAAAA,cAAc,CAAG,KAArB,CAqBA,GAAMC,CAAAA,WAAW,CAAG,CAOlBC,kBAAkB,CAAE,4BAASC,MAAT,CAAmC,CACrD,GAAIC,gCAAeC,gBAAnB,CAAqC,CACnCD,gCAAeC,gBAAf,CAAgCF,MAAhC,EACD,CACF,CAXiB,CAkBlBG,oBAAoB,CAAE,+BAAW,CAC/BF,gCAAeE,oBAAf,GACD,CApBiB,CA2BlBC,kBAAkB,CAAE,4BAClBC,WADkB,CAElBC,SAFkB,CAGlBC,WAHkB,+HAKlB,uBACE,MAAOF,CAAAA,WAAP,GAAuB,UADzB,CAEE,4CAFF,EAMAJ,gCAAeG,kBAAf,CACEG,WAAW,EAAI,EADjB,CAEEF,WAFF,CAGEC,SAAS,EAAIE,eAHf,EAXkB,8CA3BF,CAkDlBC,aAAa,CAAE,uBACbC,OADa,CAEbC,KAFa,CAGbC,OAHa,CAIL,CACR,GAAI,CAACf,cAAL,CAAqB,CACnBI,gCAAeY,cAAf,CAA8BD,OAAO,EAAI,EAAzC,EACAf,cAAc,CAAG,IAAjB,CACD,CACD,GAAMiB,CAAAA,OAAO,CAAGlB,aAAa,CAACmB,MAA9B,CACAnB,aAAa,CAACoB,IAAd,CAAmB,CACjBC,yCAAwBC,WAAxB,CAAoC,sBAApC,CAA4DR,OAA5D,CADiB,CAEjBC,KAAK,CACDM,yCAAwBC,WAAxB,CAAoC,kBAApC,CAAwDP,KAAxD,CADC,CAED,IAJa,CAAnB,EAMA,MAAOG,CAAAA,OAAP,CACD,CAnEiB,CA0ElBK,UAAU,CAAE,oBAASL,OAAT,CAA0B,CACpC,GAAMM,CAAAA,GAAG,CAAGxB,aAAa,CAACkB,OAAD,CAAzB,CACA,GAAI,CAACM,GAAL,CAAU,CAGR,OACD,CAEDA,GAAG,CAAC,CAAD,CAAH,CAAOC,MAAP,GAEA,GAAMC,CAAAA,IAAI,CAAGF,GAAG,CAAC,CAAD,CAAhB,CACAE,IAAI,EAAIA,IAAI,CAACD,MAAL,EAAR,CACAzB,aAAa,CAACkB,OAAD,CAAb,CAAyBS,SAAzB,CACA,GAAIC,CAAAA,UAAU,CAAG,IAAjB,CACA,IAAK,GAAIC,CAAAA,EAAE,CAAG,CAAd,CAAiBA,EAAE,CAAG7B,aAAa,CAACmB,MAApC,CAA4CU,EAAE,EAA9C,CAAkD,CAChD,GAAI7B,aAAa,CAAC6B,EAAD,CAAjB,CAAuB,CACrBD,UAAU,CAAG,KAAb,CACD,CACF,CACD,GAAIA,UAAJ,CAAgB,CACd1B,WAAW,CAAC4B,aAAZ,GACD,CACF,CAhGiB,CAuGlBA,aAAa,CAAE,wBAAW,CACxB,GAAI7B,cAAJ,CAAoB,CAClBI,gCAAeyB,aAAf,GACA7B,cAAc,CAAG,KAAjB,CACA,IAAK,GAAI4B,CAAAA,EAAE,CAAG,CAAd,CAAiBA,EAAE,CAAG7B,aAAa,CAACmB,MAApC,CAA4CU,EAAE,EAA9C,CAAkD,CAChD,GAAML,CAAAA,GAAG,CAAGxB,aAAa,CAAC6B,EAAD,CAAzB,CACA,GAAIL,GAAJ,CAAS,CACP,mBAAQ,KAAR,CAAe,mDAAf,EACAA,GAAG,CAAC,CAAD,CAAH,CAAOC,MAAP,GAEA,GAAMC,CAAAA,IAAI,CAAGF,GAAG,CAAC,CAAD,CAAhB,CACAE,IAAI,EAAIA,IAAI,CAACD,MAAL,EAAR,CACD,CACF,CACDzB,aAAa,CAAG,EAAhB,CACD,CACF,CAvHiB,CAApB,CA0HA+B,MAAM,CAACC,OAAP,CAAiB9B,WAAjB","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * @flow\n */\n\nimport {RNCGeolocation, GeolocationEventEmitter} from './nativeInterface';\n\nimport invariant from 'invariant';\nimport {logError, warning} from './utils';\n\nlet subscriptions = [];\nlet updatesEnabled = false;\n\ntype GeoConfiguration = {\n  skipPermissionRequests: boolean,\n  authorizationLevel: 'always' | 'whenInUse' | 'auto',\n};\n\ntype GeoOptions = {\n  timeout?: number,\n  maximumAge?: number,\n  enableHighAccuracy?: boolean,\n  distanceFilter?: number,\n  useSignificantChanges?: boolean,\n};\n\n/**\n * The Geolocation API extends the web spec:\n * https://developer.mozilla.org/en-US/docs/Web/API/Geolocation\n *\n * See https://facebook.github.io/react-native/docs/geolocation.html\n */\nconst Geolocation = {\n  /*\n   * Sets configuration options that will be used in all location requests.\n   *\n   * See https://facebook.github.io/react-native/docs/geolocation.html#setrnconfiguration\n   *\n   */\n  setRNConfiguration: function(config: GeoConfiguration) {\n    if (RNCGeolocation.setConfiguration) {\n      RNCGeolocation.setConfiguration(config);\n    }\n  },\n\n  /*\n   * Requests Location permissions based on the key configured on pList.\n   *\n   * See https://facebook.github.io/react-native/docs/geolocation.html#requestauthorization\n   */\n  requestAuthorization: function() {\n    RNCGeolocation.requestAuthorization();\n  },\n\n  /*\n   * Invokes the success callback once with the latest location info.\n   *\n   * See https://facebook.github.io/react-native/docs/geolocation.html#getcurrentposition\n   */\n  getCurrentPosition: async function(\n    geo_success: Function,\n    geo_error?: Function,\n    geo_options?: GeoOptions,\n  ) {\n    invariant(\n      typeof geo_success === 'function',\n      'Must provide a valid geo_success callback.',\n    );\n\n    // Permission checks/requests are done on the native side\n    RNCGeolocation.getCurrentPosition(\n      geo_options || {},\n      geo_success,\n      geo_error || logError,\n    );\n  },\n\n  /*\n   * Invokes the success callback whenever the location changes.\n   *\n   * See https://facebook.github.io/react-native/docs/geolocation.html#watchposition\n   */\n  watchPosition: function(\n    success: Function,\n    error?: Function,\n    options?: GeoOptions,\n  ): number {\n    if (!updatesEnabled) {\n      RNCGeolocation.startObserving(options || {});\n      updatesEnabled = true;\n    }\n    const watchID = subscriptions.length;\n    subscriptions.push([\n      GeolocationEventEmitter.addListener('geolocationDidChange', success),\n      error\n        ? GeolocationEventEmitter.addListener('geolocationError', error)\n        : null,\n    ]);\n    return watchID;\n  },\n\n  /*\n   * Unsubscribes the watcher with the given watchID.\n   *\n   * See https://facebook.github.io/react-native/docs/geolocation.html#clearwatch\n   */\n  clearWatch: function(watchID: number) {\n    const sub = subscriptions[watchID];\n    if (!sub) {\n      // Silently exit when the watchID is invalid or already cleared\n      // This is consistent with timers\n      return;\n    }\n\n    sub[0].remove();\n    // array element refinements not yet enabled in Flow\n    const sub1 = sub[1];\n    sub1 && sub1.remove();\n    subscriptions[watchID] = undefined;\n    let noWatchers = true;\n    for (let ii = 0; ii < subscriptions.length; ii++) {\n      if (subscriptions[ii]) {\n        noWatchers = false; // still valid subscriptions\n      }\n    }\n    if (noWatchers) {\n      Geolocation.stopObserving();\n    }\n  },\n\n  /*\n   * Stops observing for device location changes and removes all registered listeners.\n   *\n   * See https://facebook.github.io/react-native/docs/geolocation.html#stopobserving\n   */\n  stopObserving: function() {\n    if (updatesEnabled) {\n      RNCGeolocation.stopObserving();\n      updatesEnabled = false;\n      for (let ii = 0; ii < subscriptions.length; ii++) {\n        const sub = subscriptions[ii];\n        if (sub) {\n          warning(false, 'Called stopObserving with existing subscriptions.');\n          sub[0].remove();\n          // array element refinements not yet enabled in Flow\n          const sub1 = sub[1];\n          sub1 && sub1.remove();\n        }\n      }\n      subscriptions = [];\n    }\n  },\n};\n\nmodule.exports = Geolocation;\n"]}